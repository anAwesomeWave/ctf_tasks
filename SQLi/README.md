# SQL Injection CTF Task

## Описание уязвимости
**SQL Injection (SQLi)** — это уязвимость, возникающая из-за некорректной обработки входных данных, передаваемых в SQL-запросы. 
Она позволяет злоумышленнику вмешиваться в выполнение запросов к базе данных, модифицировать их, получать доступ к конфиденциальной информации, 
изменять данные или выполнять другие вредоносные действия.

Основной причиной SQLi является отсутствие или недостаточная экранизация пользовательских данных, 
которые напрямую передаются в SQL-запрос без проверки или использования параметризированных запросов.

### Почему возникает уязвимость:
1. **Доверие к пользовательскому вводу:** Программа предполагает, что пользовательские данные безопасны.
2. **Прямое включение данных в запрос:** Вводимые данные объединяются со строкой SQL-запроса без фильтрации.
3. **Отсутствие валидации:** Нет проверки или экранирования специальных символов, таких как `'`, `"`, `--`, и т.д.

## Способы защиты от уязвимости
1. **Использование параметризированных запросов (Prepared Statements)**:
    - Основные СУБД, включая SQLite, MySQL, Oracle, Microsoft SQL Server и PostgreSQL поддерживают
    Prepared Statements. (Пример такого запроса в данном приложении `SELECT * FROM users WHERE id = $1`)
2. **Экранирование пользовательского ввода:**
    - Использовать функции для экранирования специальных символов, предоставляемые библиотеками для работы с БД.
3. **Минимизация привилегий:**
    - Ограничение прав пользователя базы данных. Например, запрет на выполнение операций `DROP`, `DELETE`, и т.д.
4. **Валидация пользовательского ввода:**
    - Проверка формата вводимых данных с помощью регулярных выражений.

Многие веб-фреймворки и библиотеки для работы с базой данных так или иначе используют данные методы. Поэтому
наиболее простым решением будет использовать их для работы с бд.

## Запуск приложения

Для запуска приложения выполните следующие шаги:

1. Склонируйте репозиторий:
   ```bash
   git clone https://github.com/anAwesomeWave/ctf_tasks.git
   cd ctf_tasks/SQLi
   ```

2. Запустите приложение через Docker Compose:
   ```bash
   docker-compose up --build
   ```

3. Приложение будет доступно по адресу: [http://localhost:8080](http://localhost:8080)

4. Для остановки приложения выполните:
   ```bash
   docker-compose down -v
   ```

3. Приложение будет доступно по адресу: [http://localhost:8000](http://localhost:8000)

## Конфигурация приложения
В качестве конфиг. файлов выступают файлы из папки `access_control/config/`. Для конфигурирования ctf-задания
использует переменные окружения из файла `access_control/config/.app_env`.
- `ADMIN_LOGIN` - login админа
- `ADMIN_PASSWORD` - password админа
- `CTF_FLAG` - флаг задания. (Используйте не более ~30 символов, чтобы строка поместилась в картинку)
- `JWT_SIGN_KEY` - Секретный ключ для верификации подписи jwt-токенов.
- `MAX_FILE_SIZE_BYTES` - Максимальный размер файла в байтах, который может загрузить пользователь. Стандартно - 3 mb. (Для простоты, в golang можно написать fmt.Println(x << 20), где, x - нужное кол-во мегабайт).

Для расширенного конфигурирования можно использовать docker-compose файл, указав в нем resources - limits для контейнера.


## Описание уязвимости в данном приложении

В этом приложении реализована уязвимость SQL Injection на странице `/users/login`. 
Код обработки запроса принимает пользовательский ввод и вставляет его напрямую, никак не валидируя, в строку SQL-запроса:

```go
fmt.Sprintf("SELECT * FROM users WHERE login='%s' AND password='%s'", login, password)
```

Из-за этого злоумышленник может передать специальную строку, чтобы модифицировать запрос.
Например, при вводе в поле логина строки:

```
tim' -- some comment
```

SQL-запрос преобразуется в:

```sql
SELECT * FROM users WHERE login = 'tim' -- comment' AND password = ''
```

Так как набор символов `--` является обозначением начала комментария для компилятора sql,
То злоумышленник получает доступ к аккаунту администратора с логином `tim` без необходимости передавать нужный пароль.

## Шаги для получения флага

Для использования уязвимости выполните следующие шаги:

1. Смотрим на html-код подгруженной страницы. Видим, что у пользователя, картинка которого нам недоступна, login `tim`.
2. Переходим на страницу `/users/login`
3. Введите в поле "Username" следующую строку:
   ```
   tim' -- comment
   ```
4. В поле "Password" вводим произвольную последовательность.
5. Нажмите кнопку "LOGIN".

После выполнения данных действий вы получите доступ к аккаунту администратора `tim`.
Теперь, перейдя на страницу `/` или `users/me`, мы сможем увидеть искомый флаг.

